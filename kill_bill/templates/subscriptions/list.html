{% extends "base.html" %}
{% block content %}
<div class="level">
    <div class="level-left">
        <h1 class="title">Subscriptions</h1>
    </div>
    <div class="level-right">
        <a href="{% url 'subscription_create' %}" class="button is-primary">New Subscription</a>
    </div>
</div>
<div class="tabs">
    <ul>
        <li class="{% if not filter %}is-active{% endif %}"><a href="{% url 'subscription_list' %}">All</a></li>
        <li class="{% if filter == 'active' %}is-active{% endif %}"><a href="?status=active">Active</a></li>
        <li class="{% if filter == 'expiring' %}is-active{% endif %}"><a href="?status=expiring">Expiring Soon</a></li>
        <li class="{% if filter == 'expired' %}is-active{% endif %}"><a href="?status=expired">Expired</a></li>
    </ul>
</div>
<table class="table is-fullwidth is-striped">
    <thead>
    <tr>
        <th>Client</th>
        <th>Plan</th>
        <th>Billing Cycle</th>
        <th>Start</th>
        <th>End</th>
        <th>Status</th>
    </tr>
    </thead>
    <tbody>
    {% for subscription in subscriptions %}
        <tr class="{% if subscription.status == 'expired' %}overdue{% elif subscription.is_expiring_soon %}expiring{% endif %}">
            <td><a href="{% url 'subscription_detail' subscription.pk %}">{{ subscription.client.company_name }}</a></td>
            <td>{{ subscription.plan.name }}</td>
            <td>{{ subscription.get_billing_cycle_display }}</td>
            <td>{{ subscription.start_date }}</td>
            <td>{{ subscription.end_date }}</td>
            <td>{{ subscription.get_status_display }}</td>
        </tr>
    {% empty %}
        <tr><td colspan="6">No subscriptions found.</td></tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}
